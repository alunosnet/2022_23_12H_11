create table utilizadores(
	id int identity primary key,
	email varchar(100) not null unique check (email like '%@%.%'),
	nome varchar(100) not null check (len(nome)>4),
	CP varchar(8) not null check (CP like '____-___'),
	nif varchar(9) not null check (len(nif) = 9 ),
	password varchar(64) not null,
	sal int,
	estado int not null,
	perfil int not null check (perfil in ('0','1','2')), --0-Cliente 1-Jardineiro 2-Admin
	lnkRecuperar varchar(36),
	data_lnk date,
)

create table material
(
	nMaterial int identity primary key,
	nome varchar(100) not null check (len(nome) >= 2),
	data_aquisicao date not null,
	preco decimal(6,2) not null check (Preco > 0) ,
	marca varchar(100) not null check (len(marca) > 3),
	quantidade int not null
)
create table marcacoes(
	nMarcacao int identity primary key,
	nMaterial int references material(nMaterial),
	idutilizador int references utilizadores(id),
	data_trabalho date default(getdate()),
	data_fim date,
	descricao varchar(100) not null check(len(descricao) > 3 and charindex('',descricao) > 0), 
	estado int, --1=>Marcado 0=>Terminado
	constraint validardata check (data_fim > data_trabalho)
)

create table vendas(
	nVenda int identity primary key,
	idutilizador int references utilizadores(id),
	idMaterial int references material(nMaterial),
	preco decimal(6,2),
	quantidade int,
	datavenda date default(getdate()),
)

create index iMaterial_nome on material(nome)
create index iMaterial_marca on material(marca)

INSERT INTO utilizadores(email,nome,CP,nif,password,estado,perfil,sal)
VALUES ('admin@gmail.com','Jo√£o Costa','3500-001','000000001',HASHBYTES('SHA2_512',concat('12345','0')),1,2,0)

drop table vendas
drop table marcacoes
drop table utilizadores
drop table material

select * from utilizadores


mail"802ab189fb8a93", pass"3bff43a482fdcf"